[pytest]
# =============================================================================
# Pytest Configuration for Claude Playwright Agent
# =============================================================================
# This configuration file is used when running pytest-bdd tests
# Documentation: https://docs.pytest.org/

# =============================================================================
# TEST DISCOVERY
# =============================================================================
# Python file patterns for test discovery
python_files = test_*.py *_test.py

# Python class patterns for test discovery
python_classes = Test* *Tests

# Python function patterns for test discovery
python_functions = test_*

# =============================================================================
# TEST PATHS
# =============================================================================
# Directories to search for tests
testpaths = tests

# =============================================================================
# BDD CONFIGURATION
# =============================================================================
# BDD feature files location
bdd_features = features

# Enforce strict Gherkin syntax (disable for more flexible scenario writing)
bdd_strict_gherkin = false

# =============================================================================
# OUTPUT OPTIONS
# =============================================================================
# Additional command-line options
addopts =
    --verbose
    --strict-markers
    --tb=short
    --cov=src/claude_playwright_agent
    --cov-report=html:reports/coverage/html
    --cov-report=term-missing:skip-covered
    --cov-report=json:reports/coverage/coverage.json
    --asyncio-mode=auto

# Show summary of all test outcomes
# --summary=quiet  # Options: quiet, normal, verbose

# =============================================================================
# MARKERS
# =============================================================================
# Test markers for organizing tests
markers =
    smoke: Quick smoke tests that verify basic functionality
    regression: Full regression tests
    integration: Integration tests that test multiple components
    unit: Unit tests for individual functions/classes
    slow: Slow-running tests that take more than 1 minute
    api: Tests that interact with external APIs
    ui: UI tests that interact with web pages
    bdd: BDD scenario tests
    page_object: Tests for page object models
    self_healing: Tests for self-healing selector functionality
    component: Tests for component extraction

# =============================================================================
# LOGGING
# =============================================================================
# Enable live logging during test execution
log_cli = true

# Log level for console output
log_cli_level = INFO

# Log format for console output
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s

# Log date format for console output
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Log file format
log_file_format = %(asctime)s [%(levelname)8s] %(name)s [%(filename)s:%(lineno)d]: %(message)s

# Log file date format
log_file_date_format = %Y-%m-%d %H:%M:%S

# =============================================================================
# COVERAGE OPTIONS
# =============================================================================
# Coverage configuration (requires pytest-cov)
[coverage:run]
# Source code directories to measure coverage
source = src/claude_playwright_agent

# Omit these files from coverage
omit =
    */tests/*
    */test_*.py
    */__init__.py
    */venv/*
    */virtualenv/*
    */.venv/*

# Branch coverage
branch = true

# Coverage threshold (percentage)
[coverage:report]
# Fail if coverage is below threshold
fail_under = 70

# Show missing line numbers
show_missing = true

# Skip empty files
skip_empty = true

# Sort report by missing lines
sort = Miss

# =============================================================================
# WARNING CONFIGURATION
# =============================================================================
# Disable specific warnings
filterwarnings =
    # Ignore deprecation warnings from third-party libraries
    ignore::DeprecationWarning:playwright
    ignore::DeprecationWarning:pydantic

    # Treat certain warnings as errors
    error::ResourceWarning
    error::RuntimeError

# =============================================================================
# ASYNC CONFIGURATION
# =============================================================================
# Asyncio mode for async tests
asyncio_mode = auto

# =============================================================================
# TIMEOUT CONFIGURATION
# =============================================================================
# Test timeout (requires pytest-timeout)
timeout = 300
# Only apply timeout to test functions, not fixtures
timeout_func_only = true

# =============================================================================
# XPATH / SELECTOR HELPERS
# =============================================================================
# Custom pytest fixtures can be defined in conftest.py
# See tests/conftest.py for available fixtures
