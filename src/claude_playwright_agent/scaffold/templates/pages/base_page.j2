"""
Base Page Object Model class for {{ project_name }}.

This module provides a base class for all page objects, implementing
common functionality like navigation, element waiting, and screenshot capture.
"""

from typing import Any

from playwright.sync_api import Page, expect


class BasePage:
    """
    Base class for Page Object Model.

    All page objects should inherit from this class to get
    common functionality like navigation and element waiting.
    """

    def __init__(self, page: Page, base_url: str = "{{ base_url }}") -> None:
        """
        Initialize the BasePage.

        Args:
            page: Playwright Page instance
            base_url: Base URL for the application
        """
        self.page = page
        self.base_url = base_url

    # =========================================================================
    # Navigation Methods
    # =========================================================================

    def goto(self, path: str = "") -> None:
        """
        Navigate to a path relative to base_url.

        Args:
            path: Path to navigate to (e.g., "/login")
        """
        url = f"{self.base_url.rstrip('/')}/{path.lstrip('/')}"
        self.page.goto(url)

    def reload(self) -> None:
        """Reload the current page."""
        self.page.reload()

    def go_back(self) -> None:
        """Navigate back in browser history."""
        self.page.go_back()

    def go_forward(self) -> None:
        """Navigate forward in browser history."""
        self.page.go_forward()

    # =========================================================================
    # Wait Methods
    # =========================================================================

    def wait_for_load_state(self, state: str = "networkidle") -> None:
        """
        Wait for page to reach a specific load state.

        Args:
            state: Load state to wait for ("load", "domcontentloaded", "networkidle")
        """
        self.page.wait_for_load_state(state)

    def wait_for_selector(self, selector: str, timeout: int = 30000) -> Any:
        """
        Wait for an element to appear.

        Args:
            selector: CSS selector
            timeout: Timeout in milliseconds

        Returns:
            Element handle
        """
        return self.page.wait_for_selector(selector, timeout=timeout)

    def wait_for_url(self, url: str, timeout: int = 30000) -> None:
        """
        Wait for URL to match the pattern.

        Args:
            url: URL pattern to wait for
            timeout: Timeout in milliseconds
        """
        self.page.wait_for_url(url, timeout=timeout)

    # =========================================================================
    # Element Methods
    # =========================================================================

    def get_element(self, selector: str) -> Any:
        """
        Get an element by selector.

        Args:
            selector: CSS selector

        Returns:
            Element handle
        """
        return self.page.locator(selector)

    def get_text(self, selector: str) -> str:
        """
        Get text content of an element.

        Args:
            selector: CSS selector

        Returns:
            Text content
        """
        return self.get_element(selector).text_content()

    def get_attribute(self, selector: str, attribute: str) -> str:
        """
        Get an attribute value from an element.

        Args:
            selector: CSS selector
            attribute: Attribute name

        Returns:
            Attribute value
        """
        return self.get_element(selector).get_attribute(attribute)

    def is_visible(self, selector: str) -> bool:
        """
        Check if an element is visible.

        Args:
            selector: CSS selector

        Returns:
            True if visible, False otherwise
        """
        return self.get_element(selector).is_visible()

    def is_enabled(self, selector: str) -> bool:
        """
        Check if an element is enabled.

        Args:
            selector: CSS selector

        Returns:
            True if enabled, False otherwise
        """
        return self.get_element(selector).is_enabled()

    # =========================================================================
    # Screenshot Methods
    # =========================================================================

    def screenshot(self, path: str) -> None:
        """
        Take a screenshot of the current page.

        Args:
            path: Path where screenshot will be saved
        """
        self.page.screenshot(path=path)

    # =========================================================================
    # Assertion Methods
    # =========================================================================

    def assert_url(self, expected_url: str) -> None:
        """
        Assert that the current URL matches the expected URL.

        Args:
            expected_url: Expected URL
        """
        expect(self.page).to_have_url(expected_url)

    def assert_visible(self, selector: str) -> None:
        """
        Assert that an element is visible.

        Args:
            selector: CSS selector
        """
        expect(self.get_element(selector)).to_be_visible()

    def assert_text(self, selector: str, expected_text: str) -> None:
        """
        Assert that an element contains expected text.

        Args:
            selector: CSS selector
            expected_text: Expected text content
        """
        expect(self.get_element(selector)).to_contain_text(expected_text)

    def assert_title(self, expected_title: str) -> None:
        """
        Assert that the page title matches the expected title.

        Args:
            expected_title: Expected page title
        """
        expect(self.page).to_have_title(expected_title)
